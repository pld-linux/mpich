--- mpich-1.2.1/mpid/ch_p4/Makefile.in.orig	Wed Aug 16 21:22:39 2000
+++ mpich-1.2.1/mpid/ch_p4/Makefile.in	Tue May 29 22:11:11 2001
@@ -31,7 +31,7 @@
 # found in, not the directory where the compiler is running (!)
 # Trailing / causes problems for some versions of gcc (was -I./)
 # Was -I../.. -I../ch_p4
-CFLAGS   = @CFLAGS@ -I${top_srcdir}/mpid/ch2 -I${srcdir} -I${top_srcdir}/mpid/util -Ip4 -Ip4/include
+CFLAGS   = @CFLAGS@ ${OPTFLAGS} -I${top_srcdir}/mpid/ch2 -I${srcdir} -I${top_srcdir}/mpid/util -Ip4 -Ip4/include
 
 # See mpid/ch_adi2/Makefile.in for a full list
 SOURCE   = adi2recv.c adi2send.c adi2init.c adi2probe.c adi2ssend.c \
--- mpich-1.2.1/src/env/Makefile.in.orig	Tue Sep  5 16:23:17 2000
+++ mpich-1.2.1/src/env/Makefile.in	Tue May 29 22:28:29 2001
@@ -116,10 +116,10 @@
 # the MPI libraries will work
 msgqdllloc.o: ${top_srcdir}/src/env/msgqdllloc.c
 	if test -n "@SHAREDKIND_FOR_TV@" -a "@SHAREDKIND_FOR_TV@" != "ignore" ; then \
-	  ${CC} ${DEFS} ${CFLAGS} -c @CC_SHARED_OPT_FOR_TV@ \
+	  ${CC} ${DEFS} ${CFLAGS} ${OPTFLAGSC} ${OPTFLAGS} -c @CC_SHARED_OPT_FOR_TV@ \
 	  -DMPICH_INFODLL_LOC='"@libdir@/libtvmpich.so"' ${top_srcdir}/src/env/msgqdllloc.c ; \
 	else \
-	    ${CC} ${DEFS} ${CFLAGS} -c ${top_srcdir}/src/env/msgqdllloc.c ; \
+	    ${CC} ${DEFS} ${CFLAGS} ${OPTFLAGSC} ${OPTFLAGS} -c ${top_srcdir}/src/env/msgqdllloc.c ; \
 	fi
 
 .c.o:
--- mpich-1.2.1/src/infoexport/Makefile.in.orig	Fri Jan 14 21:58:04 2000
+++ mpich-1.2.1/src/infoexport/Makefile.in	Tue May 29 22:50:47 2001
@@ -6,7 +6,7 @@
 libbuild_dir      = @libbuild_dir@
 
 DEFS        = @DEFS@ ${MPIPROFILE} -I. -I${srcdir} @mpich_includes@
-CFLAGS      = -g @CC_SHARED_OPT_FOR_TV@ @CFLAGS@
+CFLAGS      = @OPTFLAGS@ @CC_SHARED_OPT_FOR_TV@ @CFLAGS@
 
 @VPATH@
 
--- mpich-1.2.1/src/fortran/configure.in.orig	Tue Aug 29 23:53:00 2000
+++ mpich-1.2.1/src/fortran/configure.in	Tue May 29 22:56:52 2001
@@ -21,7 +21,7 @@
 AC_SUBST(COPTIONS)
 AC_ARG_ENABLE(strict,
 [--enable-strict  - Turn on strict compilation testing when using gcc],
-COPTIONS="${COPTIONS} -Wall -O -Wstrict-prototypes -Wmissing-prototypes -DGCC_WALL")
+COPTIONS="${COPTIONS} -Wall -Wstrict-prototypes -Wmissing-prototypes -DGCC_WALL")
 
 AC_ARG_ENABLE(echo,
 [--enable-echo    - Turn on echoing from within the configure script],
--- mpich-1.2.1/src/fortran/configure.orig	Tue Sep  5 22:05:39 2000
+++ mpich-1.2.1/src/fortran/configure	Tue May 29 23:16:32 2001
@@ -626,7 +626,7 @@
 # Check whether --enable-strict or --disable-strict was given.
 if test "${enable_strict+set}" = set; then
   enableval="$enable_strict"
-  COPTIONS="${COPTIONS} -Wall -O -Wstrict-prototypes -Wmissing-prototypes -DGCC_WALL"
+  COPTIONS="${COPTIONS} -Wall -Wstrict-prototypes -Wmissing-prototypes -DGCC_WALL"
 fi
 
 
--- mpich-1.2.1/configure.in.orig	Tue Aug 29 23:52:53 2000
+++ mpich-1.2.1/configure.in	Tue May 29 23:05:24 2001
@@ -3075,6 +3075,8 @@
   export TESTCC ;\
   export TESTF77 ;\
   export TESTF90 ;\
+  COPTIONS="$OPTFLAGSC $OPTFLAGS"; export COPTIONS;\
+  FOPTIONS="$OPTFLAGSF $OPTFLAGS"; export FOPTIONS;\
   export mpich_includes ;\
   export LIB_PATH ;\
   export BASE_LIB_LIST ;\
--- mpich-1.2.1/configure.orig	Tue Aug 29 23:52:24 2000
+++ mpich-1.2.1/configure	Tue May 29 23:09:00 2001
@@ -13517,6 +13517,8 @@
   export TESTCC ;\
   export TESTF77 ;\
   export TESTF90 ;\
+  COPTIONS="$OPTFLAGSC $OPTFLAGS"; export COPTIONS;\
+  FOPTIONS="$OPTFLAGSF $OPTFLAGS"; export FOPTIONS;\
   export mpich_includes ;\
   export LIB_PATH ;\
   export BASE_LIB_LIST ;\
--- mpich-1.2.1/configure.in.orig	Tue May 29 23:17:33 2001
+++ mpich-1.2.1/configure.in	Wed May 30 00:18:31 2001
@@ -3193,8 +3193,8 @@
 	    -mpibindir=$binbuild_dir \
             -mpilib=$libbuild_dir/lib$MPILIBNAME.a \
             -mpiolib=$libbuild_dir/lib$MPILIBNAME.a \
-            -cc="$CC" -cflags="$ROMIO_CFLAGS $CC_SHARED_OPT" \
-            -fc="$F77" -fflags="$ROMIO_FFLAGS $FC_SHARED_OPT" -f90="$F90" $romio_config_args )
+            -cc="$CC" -cflags="$ROMIO_CFLAGS $CC_SHARED_OPT $OPTFLAGSC $OPTFLAGS" \
+            -fc="$F77" -fflags="$ROMIO_FFLAGS $FC_SHARED_OPT $OPTFLAGSF $OPTFLAGS" -f90="$F90" $romio_config_args )
   /bin/rm -f include/mpio.h ${top_srcdir}/include/mpio.h
   cp romio/include/mpio.h include
   ROMIO_LFLAGS="`$MAKE -f romio/Makefile romio_lflags`"
--- mpich-1.2.1/configure.orig	Tue May 29 23:17:34 2001
+++ mpich-1.2.1/configure	Wed May 30 00:19:09 2001
@@ -13723,8 +13723,8 @@
 	    -mpibindir=$binbuild_dir \
             -mpilib=$libbuild_dir/lib$MPILIBNAME.a \
             -mpiolib=$libbuild_dir/lib$MPILIBNAME.a \
-            -cc="$CC" -cflags="$ROMIO_CFLAGS $CC_SHARED_OPT" \
-            -fc="$F77" -fflags="$ROMIO_FFLAGS $FC_SHARED_OPT" -f90="$F90" $romio_config_args )
+            -cc="$CC" -cflags="$ROMIO_CFLAGS $CC_SHARED_OPT $OPTFLAGSC $OPTFLAGS" \
+            -fc="$F77" -fflags="$ROMIO_FFLAGS $FC_SHARED_OPT $OPTFLAGSF $OPTFLAGS" -f90="$F90" $romio_config_args )
   /bin/rm -f include/mpio.h ${top_srcdir}/include/mpio.h
   cp romio/include/mpio.h include
   ROMIO_LFLAGS="`$MAKE -f romio/Makefile romio_lflags`"
--- mpich-1.2.1/romio/configure.in.orig	Fri Aug 25 19:24:48 2000
+++ mpich-1.2.1/romio/configure.in	Wed May 30 00:23:42 2001
@@ -387,8 +387,8 @@
     USER_CFLAGS="$CFLAGS -g"
     USER_FFLAGS="$FFLAGS -g"
 else
-    USER_CFLAGS="$CFLAGS -O"
-    USER_FFLAGS="$FFLAGS -O"
+    USER_CFLAGS="$CFLAGS"
+    USER_FFLAGS="$FFLAGS"
 fi
 #
 if test -n "$arch_sun4" ; then 
@@ -396,12 +396,12 @@
     F77=${FC:-f77}
     if test $DEBUG = 1; then
 	if test "$CC" = "gcc"; then
-           CFLAGS="$CFLAGS -g -O -Wall -Wstrict-prototypes -Wmissing-prototypes -DAIO_SUN"
+           CFLAGS="$CFLAGS -g -Wall -Wstrict-prototypes -Wmissing-prototypes -DAIO_SUN"
 	else
            CFLAGS="$CFLAGS -g -DAIO_SUN"
         fi
     else 
-        CFLAGS="$CFLAGS -O -DAIO_SUN"
+        CFLAGS="$CFLAGS -DAIO_SUN"
     fi
     if test -z "$MPI" ; then
         MPI=mpich
@@ -420,12 +420,12 @@
     F77=${FC:-f77}
     if test $DEBUG = 1; then
         if test "$CC" = "gcc" ; then
-            CFLAGS="$CFLAGS -g -O -Wall -Wstrict-prototypes -Wmissing-prototypes -DAIO_SUN"
+            CFLAGS="$CFLAGS -g -Wall -Wstrict-prototypes -Wmissing-prototypes -DAIO_SUN"
         else 
             CFLAGS="$CFLAGS -g -v -DAIO_SUN"
         fi
     else 
-        CFLAGS="$CFLAGS -O -DAIO_SUN"
+        CFLAGS="$CFLAGS -DAIO_SUN"
     fi
     if test -z "$MPI" ; then
         MPI=mpich
@@ -466,7 +466,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g -DNO_FD_IN_AIOCB -DAIO_HANDLE_IN_AIOCB"
     else 
-        CFLAGS="$CFLAGS -O -DNO_FD_IN_AIOCB -DAIO_HANDLE_IN_AIOCB"
+        CFLAGS="$CFLAGS -DNO_FD_IN_AIOCB -DAIO_HANDLE_IN_AIOCB"
     fi
     if test -z "$MPI" ; then
         MPI=mpich
@@ -498,9 +498,9 @@
         CFLAGS="$CFLAGS -g"
     else 
 	if test "$CC" = "icc"; then
-           CFLAGS="$CFLAGS -Knoieee -Mvect -O3"
+           CFLAGS="$CFLAGS -Knoieee -Mvect"
 	else
-           CFLAGS="$CFLAGS -O"
+           CFLAGS="$CFLAGS"
         fi
     fi
     AR="ar860 cr$AR_LOCAL"
@@ -530,9 +530,9 @@
         CFLAGS="$CFLAGS -g $TFLOP_FLAGS"
     else
        if test "$CC" = "pgcc"; then
-           CFLAGS="$CFLAGS -Knoieee -Mvect -O3 $TFLOP_FLAGS"
+           CFLAGS="$CFLAGS -Knoieee -Mvect $TFLOP_FLAGS"
        else
-           CFLAGS="$CFLAGS -O $TFLOP_FLAGS"
+           CFLAGS="$CFLAGS $TFLOP_FLAGS"
        fi
     fi
     AR="xar cr$AR_LOCAL"
@@ -563,12 +563,12 @@
     fi
     if test $DEBUG = 1 ; then
 	if test "$CC" = "gcc" ; then
-            CFLAGS="$CFLAGS -g -O -Wall -Wstrict-prototypes -Wmissing-prototypes -DNO_AIO"
+            CFLAGS="$CFLAGS -g -Wall -Wstrict-prototypes -Wmissing-prototypes -DNO_AIO"
         else
 	    CFLAGS="$CFLAGS -g -DNO_AIO"
         fi
     else 
-        CFLAGS="$CFLAGS -O -DNO_AIO"
+        CFLAGS="$CFLAGS -DNO_AIO"
     fi
     if test -z "$MPI" ; then
         MPI=mpich
@@ -590,7 +590,7 @@
         FFLAGS="$FFLAGS -g"
     else
         USER_FFLAGS="$FFLAGS -Chopt"
-        CFLAGS="$CFLAGS -O -DNO_AIO -DSX4"
+        CFLAGS="$CFLAGS -DNO_AIO -DSX4"
         FFLAGS="$FFLAGS -Chopt"
     fi
     if test -z "$MPI" ; then
@@ -611,7 +611,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g +w1 -DNO_AIO"
     else 
-        CFLAGS="$CFLAGS -O -DNO_AIO"
+        CFLAGS="$CFLAGS -DNO_AIO"
     fi
     RANLIB=":"
     if test -z "$MPI"; then
@@ -683,7 +683,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g -std1 -warnprotos -verbose -DAIO_PRIORITY_DEFAULT"
     else 
-        CFLAGS="$CFLAGS -O -DAIO_PRIORITY_DEFAULT"
+        CFLAGS="$CFLAGS -DAIO_PRIORITY_DEFAULT"
     fi
     MPI_LIB="$MPI_LIB -laio"
     if test -z "$MPI" ; then
@@ -711,7 +711,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g -DNO_AIO"
     else 
-        CFLAGS="$CFLAGS -O -DNO_AIO"
+        CFLAGS="$CFLAGS -DNO_AIO"
     fi
     RANLIB=":"
     CFLAGS="$CFLAGS -DCRAY -D_UNICOS"
@@ -775,7 +775,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g -fullwarn"
     else 
-        CFLAGS="$CFLAGS -O"
+        CFLAGS="$CFLAGS"
     fi
    if test $osversion = 4 ; then
 	RANLIB="ar ts"
--- mpich-1.2.1/romio/configure.orig	Fri Aug 25 19:24:45 2000
+++ mpich-1.2.1/romio/configure	Wed May 30 00:26:59 2001
@@ -583,8 +583,8 @@
     USER_CFLAGS="$CFLAGS -g"
     USER_FFLAGS="$FFLAGS -g"
 else
-    USER_CFLAGS="$CFLAGS -O"
-    USER_FFLAGS="$FFLAGS -O"
+    USER_CFLAGS="$CFLAGS"
+    USER_FFLAGS="$FFLAGS"
 fi
 #
 if test -n "$arch_sun4" ; then 
@@ -592,12 +592,12 @@
     F77=${FC:-f77}
     if test $DEBUG = 1; then
 	if test "$CC" = "gcc"; then
-           CFLAGS="$CFLAGS -g -O -Wall -Wstrict-prototypes -Wmissing-prototypes -DAIO_SUN"
+           CFLAGS="$CFLAGS -g -Wall -Wstrict-prototypes -Wmissing-prototypes -DAIO_SUN"
 	else
            CFLAGS="$CFLAGS -g -DAIO_SUN"
         fi
     else 
-        CFLAGS="$CFLAGS -O -DAIO_SUN"
+        CFLAGS="$CFLAGS -DAIO_SUN"
     fi
     if test -z "$MPI" ; then
         MPI=mpich
@@ -616,12 +616,12 @@
     F77=${FC:-f77}
     if test $DEBUG = 1; then
         if test "$CC" = "gcc" ; then
-            CFLAGS="$CFLAGS -g -O -Wall -Wstrict-prototypes -Wmissing-prototypes -DAIO_SUN"
+            CFLAGS="$CFLAGS -g -Wall -Wstrict-prototypes -Wmissing-prototypes -DAIO_SUN"
         else 
             CFLAGS="$CFLAGS -g -v -DAIO_SUN"
         fi
     else 
-        CFLAGS="$CFLAGS -O -DAIO_SUN"
+        CFLAGS="$CFLAGS -DAIO_SUN"
     fi
     if test -z "$MPI" ; then
         MPI=mpich
@@ -706,7 +706,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g -DNO_FD_IN_AIOCB -DAIO_HANDLE_IN_AIOCB"
     else 
-        CFLAGS="$CFLAGS -O -DNO_FD_IN_AIOCB -DAIO_HANDLE_IN_AIOCB"
+        CFLAGS="$CFLAGS -DNO_FD_IN_AIOCB -DAIO_HANDLE_IN_AIOCB"
     fi
     if test -z "$MPI" ; then
         MPI=mpich
@@ -738,9 +738,9 @@
         CFLAGS="$CFLAGS -g"
     else 
 	if test "$CC" = "icc"; then
-           CFLAGS="$CFLAGS -Knoieee -Mvect -O3"
+           CFLAGS="$CFLAGS -Knoieee -Mvect"
 	else
-           CFLAGS="$CFLAGS -O"
+           CFLAGS="$CFLAGS"
         fi
     fi
     AR="ar860 cr$AR_LOCAL"
@@ -770,9 +770,9 @@
         CFLAGS="$CFLAGS -g $TFLOP_FLAGS"
     else
        if test "$CC" = "pgcc"; then
-           CFLAGS="$CFLAGS -Knoieee -Mvect -O3 $TFLOP_FLAGS"
+           CFLAGS="$CFLAGS -Knoieee -Mvect $TFLOP_FLAGS"
        else
-           CFLAGS="$CFLAGS -O $TFLOP_FLAGS"
+           CFLAGS="$CFLAGS $TFLOP_FLAGS"
        fi
     fi
     AR="xar cr$AR_LOCAL"
@@ -862,12 +862,12 @@
     fi
     if test $DEBUG = 1 ; then
 	if test "$CC" = "gcc" ; then
-            CFLAGS="$CFLAGS -g -O -Wall -Wstrict-prototypes -Wmissing-prototypes -DNO_AIO"
+            CFLAGS="$CFLAGS -g -Wall -Wstrict-prototypes -Wmissing-prototypes -DNO_AIO"
         else
 	    CFLAGS="$CFLAGS -g -DNO_AIO"
         fi
     else 
-        CFLAGS="$CFLAGS -O -DNO_AIO"
+        CFLAGS="$CFLAGS -DNO_AIO"
     fi
     if test -z "$MPI" ; then
         MPI=mpich
@@ -889,7 +889,7 @@
         FFLAGS="$FFLAGS -g"
     else
         USER_FFLAGS="$FFLAGS -Chopt"
-        CFLAGS="$CFLAGS -O -DNO_AIO -DSX4"
+        CFLAGS="$CFLAGS -DNO_AIO -DSX4"
         FFLAGS="$FFLAGS -Chopt"
     fi
     if test -z "$MPI" ; then
@@ -910,7 +910,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g +w1 -DNO_AIO"
     else 
-        CFLAGS="$CFLAGS -O -DNO_AIO"
+        CFLAGS="$CFLAGS -DNO_AIO"
     fi
     RANLIB=":"
     if test -z "$MPI"; then
@@ -998,7 +998,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g -std1 -warnprotos -verbose -DAIO_PRIORITY_DEFAULT"
     else 
-        CFLAGS="$CFLAGS -O -DAIO_PRIORITY_DEFAULT"
+        CFLAGS="$CFLAGS -DAIO_PRIORITY_DEFAULT"
     fi
     MPI_LIB="$MPI_LIB -laio"
     if test -z "$MPI" ; then
@@ -1026,7 +1026,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g -DNO_AIO"
     else 
-        CFLAGS="$CFLAGS -O -DNO_AIO"
+        CFLAGS="$CFLAGS -DNO_AIO"
     fi
     RANLIB=":"
     CFLAGS="$CFLAGS -DCRAY -D_UNICOS"
@@ -1285,7 +1285,7 @@
     if test $DEBUG = 1; then
         CFLAGS="$CFLAGS -g -fullwarn"
     else 
-        CFLAGS="$CFLAGS -O"
+        CFLAGS="$CFLAGS"
     fi
    if test $osversion = 4 ; then
 	RANLIB="ar ts"
--- mpich-1.2.1/Makefile.in.orig	Tue Sep  5 22:06:05 2000
+++ mpich-1.2.1/Makefile.in	Wed May 30 01:07:43 2001
@@ -327,7 +327,7 @@
 	CXX="g++" ; export CXX ; \
 	ldir=`echo $(libdir) | sed -e 's%$(MPIR_HOME)/%%g'` ; \
 	if ${top_srcdir}/MPI-2-C++/configure --with-mpich=.. \
-			--with-libopt=" " \
+			--with-libopt="@OPTFLAGS@" \
 			 --with-profiling \
 			 --with-mpichbin=${binbuild_dir} \
 			 --with-mpichlib=${libbuild_dir} \
--- mpich-1.2.1/configure.in.orig	Wed May 30 01:51:15 2001
+++ mpich-1.2.1/configure.in	Wed May 30 01:56:34 2001
@@ -3270,6 +3270,7 @@
 				  --with-f2cmpilibs=-lfmpich \
                                   --with-flib_path_leader=$LIB_PATH_LEADER \
                                   --prefix=${prefix} $enable_args \
+				  --with-cflags="$OPTFLAGSC $OPTFLAGS" \
 				  $MPE_ARGS )
     if test $? = 0 ; then
         echo "Done configuring MPE Profiling Libraries" ; echo
--- mpich-1.2.1/configure.orig	Wed May 30 01:51:15 2001
+++ mpich-1.2.1/configure	Wed May 30 01:57:11 2001
@@ -13800,6 +13800,7 @@
 				  --with-f2cmpilibs=-lfmpich \
                                   --with-flib_path_leader=$LIB_PATH_LEADER \
                                   --prefix=${prefix} $enable_args \
+				  --with-cflags="$OPTFLAGSC $OPTFLAGS" \
 				  $MPE_ARGS )
     if test $? = 0 ; then
         echo "Done configuring MPE Profiling Libraries" ; echo
--- mpich-1.2.1/Makefile.in.orig	Wed May 30 02:39:08 2001
+++ mpich-1.2.1/Makefile.in	Wed May 30 04:19:59 2001
@@ -467,6 +467,7 @@
 serv_p4 server:
 	if [ ! -d mpid/server ] ; then mkdir mpid/server ; fi
 	( cd mpid/server ; /bin/rm -f config.cache ; \
+	  CFLAGS="@OPTFLAGSC@ @OPTFLAGS@"; export CFLAGS ; \
 	  CC="@CC@" ; export CC ; MAKE="${MAKE}" ; export MAKE ; \
 	  ${top_srcdir}/mpid/server/configure ; $(MAKE) serv_p4 ; \
 	  cp serv_p4 $(binbuild_dir) )
--- mpich-1.2.1/mpid/ch_p4/setup_ch_p4.orig	Fri Aug 18 21:45:14 2000
+++ mpich-1.2.1/mpid/ch_p4/setup_ch_p4	Wed May 30 05:11:02 2001
@@ -253,6 +253,7 @@
 echo "Configuring new p4 secure server"
 (cd mpid/server ; \
     CC="$CC" ; export CC ; \
+    CFLAGS="$OPTFLAGS"; export CFLAGS ; \
     $top_srcdir/mpid/server/configure )
 if test $? != 0 ; then
     print_error "Configure of the secure server may have failed!"
